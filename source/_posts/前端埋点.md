---
title: å‰ç«¯åŸ‹ç‚¹
date: 2023-04-19 13:10:29
tags: åŸ‹ç‚¹
---

## å‰ç«¯åŸ‹ç‚¹

### å‰ç«¯åŸ‹ç‚¹æ˜¯å¹²å•¥çš„
1. æ•°æ®ç›‘æ§ï¼ˆç›‘æ§ç”¨æˆ·è¡Œä¸ºï¼‰
   1. ç»Ÿè®¡é¡µé¢pv uv
   2. ç”¨æˆ·åœ¨æ¯ä¸ªé¡µé¢åœç•™çš„æ—¶é—´
   3. ç”¨æˆ·åœ¨æ¯ä¸ªé¡µé¢è§¦å‘çš„è¡Œä¸º
2. æ€§èƒ½ç›‘æ§
   1. é¦–å±åŠ è½½æ—¶é—´
   2. httpè¯·æ±‚æ—¶é—´
   3. é¡µé¢æ¸²æŸ“æ—¶é—´

### åŸ‹ç‚¹æ–¹æ¡ˆæ€»ç»“
1. æ‰‹åŠ¨åŸ‹ç‚¹
2. å£°æ˜å¼åŸ‹ç‚¹
3. å¯è§†åŒ–åŸ‹ç‚¹
4. å…¨åŸ‹ç‚¹ï¼ˆæ— åŸ‹ç‚¹ï¼‰ äº‹ä»¶åŸ‹ç‚¹ä¸ŠæŠ¥ï¼Œåœç•™æ—¶é—´ä¸ŠæŠ¥

### äº‹ä»¶åŸ‹ç‚¹ä¸ŠæŠ¥

é€šè¿‡ç»™å…ƒç´ ç»‘å®šè‡ªå®šä¹‰æŒ‡ä»¤çš„æ–¹å¼å®ç°(å‡å°‘å¯¹åŸæœ‰ä»£ç çš„ä¾µå…¥)ğŸœï¼Œå°†ä¿¡æ¯å­˜å‚¨åœ¨ç¼“å­˜æ± ä¸­å®šæ—¶ä¸ŠæŠ¥ï¼Œä¸ŠæŠ¥ä¹‹åæ¸…ç©ºä¹‹å‰çš„ä¸ŠæŠ¥ä¿¡æ¯

å¯ä»¥å†™ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ uni-app
```js
import Vue from "vue";
// è‡ªå®šä¹‰åŸ‹ç‚¹æŒ‡ä»¤
Vue.directive("buried", {
  bind: (el, binding) => {
    if (binding.value) {
      //è¿™é‡Œå‚æ•°æ˜¯æ ¹æ®è‡ªå·±ä¸šåŠ¡å¯ä»¥è‡ªå·±å®šä¹‰
      let params = {
        currentUrl: binding.value.currentUrl,
        triggerType: binding.value.triggerType,
        title: binding.value.title,
        frontTriggerType: binding.value.triggerType,
        behavior: binding.value.behavior,
      };
      //å¦‚æœæ˜¯æµè§ˆç±»å‹ï¼Œç›´æ¥ä¿å­˜,ç›®å‰åªè€ƒè™‘ç‚¹å‡»ç±»å‹
      if (binding.value.triggerType == "browse") {
        console.log("browse", params);
        //è°ƒç”¨åå°æ¥å£ä¿å­˜æ•°æ®
      } else if (binding.value.triggerType == "click") {
        //å¦‚æœæ˜¯clickç±»å‹ï¼Œç›‘å¬clickäº‹ä»¶
        el.addEventListener(
          "click",
          () => {
            // å°†æ“ä½œå’Œå†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­å®šæ—¶ä¸ŠæŠ¥
            let buriedArray = uni.getStorageSync('buriedArray') //è·å–åŸ‹ç‚¹é›†åˆ
            buriedArray.push(params)  // å°†åŸ‹ç‚¹é›†åˆå­˜å…¥ç¼“å­˜ä¸­
            uni.setStorageSync('buriedArray', buriedArray)
          },
          false
        );
      }
    }
  },
});
```
ä½¿ç”¨æ—¶
```vue
<!-- 
triggerType: äº‹ä»¶ç±»å‹
title: é¡µé¢æ ‡é¢˜
currentUrl: é¡µé¢è·¯ç”±
behavior: æ“ä½œè¡Œä¸º
-->
<view v-buried="{
triggerType:'click',
title:'æˆ‘çš„',
currentUrl: currentPath,
behavior:'ç‚¹å‡»æˆ‘çš„æ”¶è—æŒ‰é’®'}">
</view>
```

### åœç•™æ—¶é—´ä¸ŠæŠ¥

éœ€è¦é‡æ–°å°è£…è·¯ç”±ï¼Œåˆ›å»ºè·¯ç”±æ‹¦æˆªåœ¨è·³è½¬ä¹‹å‰è®°å½•æ¥æº,ä»¥åŠä¸Šä¸€ä¸ªé¡µé¢çš„åœç•™æ—¶é—´ï¼Œå½“æ‹¦æˆªå™¨æ•è·æˆåŠŸä¹‹åğŸŒ¯ï¼Œå¦‚æœå‘ç°åœç•™æ—¶é—´å¤§äºxxç§’è¿›è¡Œä¸ŠæŠ¥

```js
import Vue from 'vue';
import v5 from 'uuid/v5';
import UniRouteGuard from '@/js_sdk/pocky-route-gurads/lib';
import router from '@/router'
Vue.use(UniRouteGuard);
 
const guard = new UniRouteGuard();
 
let startTime = Date.now();
guard.beforeEach((to, from, next) => {
	let currentTime = Date.now();
	if (from.url && from.url == '/pages/first/index') {
		next()
		return
	}
	console.log(router)
	if (to.url) {
		if (to.url.indexOf('?') > -1) {
			to.url = to.url.substr(0, to.url.indexOf('?'))
		}
	}
	let fromName = router.find(item => item.path == from.url) ? router.find(item => item.path == from.url).title : 'æœªçŸ¥'
	let toName = router.find(item => item.path == to.url) ? router.find(item => item.path == to.url).title : 'æœªçŸ¥'
  const stayTime=  parseInt((currentTime - startTime) / 1000)
	const MY_NAMESPACE = '1b671a64-40d5-491e-99b0-da01ff1f3341';
 
	console.log(`ç”±${fromName}è·³è½¬åˆ°${toName}å¹¶åœ¨${fromName}ä¸­åœç•™äº†${stayTime}ç§’é’Ÿ`);
	let params = {
		fromUrl: from.url, //æ¥æºåœ°å€
		toUrl: to.url, // ç›®çš„åœ°å€
		fromName: fromName, // æ¥æºåç§°
		toName: toName, // ç›®çš„åç§°
		stayTime: stayTime, // åœç•™æ—¶é•¿
		guid: v5(from.url, MY_NAMESPACE), //é¡µé¢uuid
		appUuid: uni.getStorageSync('appUuid') ? uni.getStorageSync('appUuid') : '', // appå”¯ä¸€æ ‡è¯†
		model: uni.getStorageSync("model")? uni.getStorageSync('model') : '', // æ‰‹æœºå‹å·
	}
	console.log(params)
  if(stayTime>10){
   // ä¸ŠæŠ¥é€»è¾‘
    console.log('åœç•™çš„æ—¶é—´å¤§äº10ç§’é’Ÿäº†ï¼Œå¯ä»¥è¿›è¡Œä¸ŠæŠ¥')
  }
  startTime = Date.now();
	next();
});
```


https://blog.csdn.net/hsany330/article/details/125070076